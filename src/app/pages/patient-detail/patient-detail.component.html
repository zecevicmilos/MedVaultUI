<div class="card" *ngIf="info">
<h3>{{info.firstName}} {{info.lastName}} <small class="badge">MRN: {{info.medicalRecordNumber}}</small></h3>
<small class="muted">Created: {{info.createdAt | date:'short'}}</small>


<div class="tabs mt">
<div class="tab" [class.active]="tab==='ov'" (click)="tab='ov'">Overview</div>
<div class="tab" [class.active]="tab==='sc'" (click)="tab='sc'">Scans</div>
<div class="tab" [class.active]="tab==='id'" (click)="tab='id'">Identity Docs</div>
<div class="tab" [class.active]="tab==='en'" (click)="tab='en'">Encounters</div>
<div class="tab" [class.active]="tab==='co'" (click)="tab='co'">Consents</div>
</div>


<!-- Overview -->
<div *ngIf="tab==='ov'" class="grid" style="grid-template-columns:1fr 1fr">
<div>
<div class="label">First Name</div>
<div class="input" style="background:#f8fafc">{{info.firstName}}</div>
</div>
<div>
<div class="label">Last Name</div>
<div class="input" style="background:#f8fafc">{{info.lastName}}</div>
</div>
</div>


<!-- Scans -->
<div *ngIf="tab==='sc'" class="mt">
<div class="row">
<select class="input" [(ngModel)]="scanType" style="max-width:160px">
<option>PDF</option><option>XRay</option><option>Ultrasound</option><option>CT</option><option>Image</option>
</select>
<input type="file" (change)="onScan($event)" accept="application/pdf,image/*"/>
<button class="btn pri" (click)="uploadScan()">Upload & Encrypt</button>
</div>
<table class="table mt" *ngIf="recs.length">
<thead><tr><th>Type</th><th>Name</th><th>Size</th><th>Padding</th><th>Date</th><th></th></tr></thead>
<tbody>
<tr *ngFor="let r of recs">
<td>{{r.recordType}}</td>
<td>{{r.originalFileName}}</td>
<td>{{r.originalLength}}</td>
<td>{{r.paddingLength}}</td>
<td>{{r.createdAt | date:'short'}}</td>
<td>
<button class="btn" (click)="downloadScan(r.id, r.originalFileName)">Download</button>
<button class="btn err" *ngIf="auth.role==='Admin'" (click)="deleteScan(r.id)">Delete</button>
</td>
</tr>
</tbody>
</table>
</div>


<!-- Identity Docs -->
<div *ngIf="tab==='id'" class="mt">
<div class="row" *ngIf="auth.role==='Admin'">
<input class="input" [(ngModel)]="idDocType" placeholder="Type" style="max-width:180px"/>
<input class="input" [(ngModel)]="idDocNumber" placeholder="Document Number" style="max-width:220px"/>
<input class="input" type="date" [(ngModel)]="idIssue" placeholder="Issue"/>
<input class="input" type="date" [(ngModel)]="idExpiry" placeholder="Expiry"/>
<input type="file" (change)="onIdFile($event)" accept="application/pdf,image/*"/>
<button class="btn ok" (click)="saveId()">Save</button>
</div>
<table class="table mt" *ngIf="iddocs.length">
<thead><tr><th>Type</th><th>Scan</th><th>Date</th><th></th></tr></thead>
<tbody>
<tr *ngFor="let d of iddocs">
<td>{{d.docType}}</td>
<td>{{d.hasScan ? 'Yes' : 'No'}}</td>
<td>{{d.createdAt | date:'short'}}</td>
<td><button class="btn" (click)="downloadId(d.id)" [disabled]="!d.hasScan">Download</button></td>
</tr>
</tbody>
</table>
</div>


<!-- Encounters -->
<div *ngIf="tab==='en'" class="mt">
<div class="row">
<input class="input" type="datetime-local" [(ngModel)]="encDate" style="max-width:230px"/>
<input class="input" [(ngModel)]="encNotes" placeholder="Notes (optional)"/>
<button class="btn ok" (click)="saveEnc()">Add Encounter</button>
</div>
<table class="table mt" *ngIf="encs.length">
<thead><tr><th>Date</th><th></th></tr></thead>
<tbody>
